# クリプト取引情報可視化ツール

このツールは、仮想通貨取引所の取引データを分析・可視化するStreamlitアプリケーションです。

## 機能

- 年ごとまたは全期間の取引データ分析
- コインごとの価格指定による評価額計算
- 元本、取得コイン数、評価額、含み益、平均取得単価の表示
- 期間年ごとの確定利益の計算
- コインの取得枚数、評価額、元本・含み益の推移確認
- 平均取得単価と取得枚数、評価額の動的な可視化

## 環境構築

### 前提条件

- [mise](https://github.com/jdx/mise)がインストールされていること
- [uv](https://github.com/astral-sh/uv)がインストールされていること（0.3.0以上推奨）

### セットアップ手順

1. リポジトリをクローン後、プロジェクトディレクトリに移動

```bash
cd analysis_crypt
```

2. miseでPythonバージョンを設定

```bash
mise install python@3.11
```

3. uvでパッケージをインストールと開発環境のセットアップ

```bash
# 仮想環境の作成
uv venv --python $(mise which python)
source .venv/bin/activate

# 依存関係のインストールとロックファイルの生成
uv sync

```

`uv sync`コマンドにより、`pyproject.toml`に定義された依存関係がインストールされ、`uv.lock`ファイルが生成されます。このロックファイルにより環境の再現性が確保されます。

新しい環境で再現する場合は、既存の`uv.lock`ファイルを使用して、以下のコマンドで同一環境を再現できます：

```bash
uv venv --python $(mise which python)
source .venv/bin/activate
uv sync
```

4. アプリケーションの起動

```bash
streamlit run src/app.py
```

## データ配置について

`resource`ディレクトリに取引データを配置する必要があります。以下のディレクトリ構造に従ってCSVファイルを配置してください：

```
resource/
└── [取引所名]/
    └── transactions_YYYY.csv  # 取引データ（YYYYは年）
```

**注意**: `resource`ディレクトリは`.gitignore`に記載されており、個人情報保護のためGit管理対象外です。

### CSVファイルの構成

取引データのCSVファイルは以下のカラムを含む必要があります：

| カラム名 | 説明 | 必須/任意 | 備考 |
|---------|------|---------|------|
| 日時 | 取引日時（YYYY/MM/DD HH:MM形式） | 必須 | 年別分析に使用 |
| 精算区分 | 取引の種類（取引所現物取引、販売所取引、日本円入出金など） | 必須 | 取引タイプの判別に使用 |
| 銘柄名 | 通貨の種類（BTC、ETH、SOL、XRP、DOGE、XLM、JPYなど） | 必須 | コイン種別の判別に使用 |
| 売買区分 | 「買」または「売」 | 必須 | 取引方向の判別に使用 |
| 約定数量 | 取引したコインの数量 | 必須※ | ※約定数量または数量のいずれかが必要 |
| 約定レート | 取引時のレート | 任意 | 約定金額がない場合に使用 |
| 約定金額 | 取引金額 | 任意 | 約定レート×約定数量がない場合に使用 |
| 日本円受渡金額 | 日本円での取引金額 | 任意 | 販売所取引などで使用 |
| 注文手数料 | 取引手数料 | 任意 | 原価計算に使用 |
| 授受区分 | 「預入」または「送付」（ステーキング関連） | 任意 | ステーキング報酬の判別に使用 |
| 数量 | 入出金やステーキングなどでの数量 | 任意 | 約定数量がない場合に使用 |
| 送付手数料 | 送金手数料 | 任意 | コスト計算に使用 |

### サンプルCSVデータ

以下は各取引タイプを含むサンプルデータです：

| 日時 | 精算区分 | 日本円受渡金額 | 注文ID | 約定ID | 建玉ID | 銘柄名 | 注文タイプ | 取引区分 | 売買区分 | 執行条件 | 約定数量 | 約定レート | 約定金額 | 注文手数料 | レバレッジ手数料 | 入出金区分 | 入出金金額 | 授受区分 | 数量 | 送付手数料 | 送付先/送付元 | トランザクションID |
|------|---------|--------------|-------|-------|-------|-------|---------|---------|--------|---------|--------|---------|--------|-----------|--------------|----------|-----------|---------|------|-----------|-------------|-----------------|
| 2024/03/11 20:07 | 日本円入出金 | 70000 | | | | JPY | | | | | | | | | | 即時入金 | 70000 | | | | | |
| 2024/03/11 20:35 | 取引所現物取引 | -29545 | XXXX | | | ETH | | | 買 | 成行 | 0.05 | 590598 | 29530 | 15 | | | | | | | | |
| 2024/03/17 18:00 | 取引所現物取引 | 22227 | XXXX | | | SOL | | | 売 | 成行 | 0.8 | 27810 | 22248 | 21 | | | | | | | | |
| 2024/03/25 13:00 | 販売所取引 | -500 | | XXXX | | BTC | | | 買 | | 0.00004789 | 10438874 | 500 | | | | | | | | | |
| 2024/04/12 22:18 | 暗号資産預入・送付 | | | | | SOL | | | | | | | | | | | | 預入 | 0.00100112 | | ステーキング | XXXX |
| 2024/04/12 22:18 | 暗号資産預入・送付 | | | | | SOL | | | | | | | | | | | | 送付 | 0.000280314 | | ステーキング手数料 | XXXX |
| 2024/05/31 06:04 | 取引所現物 取引手数料返金 | 1 | | | | SOL | | | | | | | | | | | | | | | | |

### サポートされる取引タイプ

このアプリケーションは以下の取引タイプを認識・処理します：

1. **購入取引**
   - 取引所現物取引（買）
   - 販売所取引（買）

2. **売却取引**
   - 取引所現物取引（売）
   - 販売所取引（売）

3. **ステーキング関連**
   - 暗号資産預入・送付（預入）：ステーキング報酬
   - 暗号資産預入・送付（送付）：ステーキング手数料

4. **その他**
   - 日本円入出金
   - 取引所現物 取引手数料返金

### 対応している仮想通貨

このアプリケーションは、CSVファイルの「銘柄名」カラムに記載されている任意の仮想通貨に対応しています。CSVファイルから自動的に銘柄名を読み取り、分析対象として追加します。

以下は一般的な仮想通貨の例です：
- BTC（ビットコイン）
- ETH（イーサリアム）
- SOL（ソラナ）
- XRP（リップル）
- DOGE（ドージコイン）
- XLM（ステラルーメン）
- その他のあらゆる仮想通貨

## 利用方法

1. アプリケーション起動後、左サイドバーで分析したい年とコインごとの現在価格を入力
2. タブを選択して各種分析結果を閲覧
3. 「チェックポイント記録」ボタンをクリックすると、その時点の評価額等がログとして保存され、推移グラフに反映 
